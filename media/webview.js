"use strict";(()=>{var I=acquireVsCodeApi(),N,C=(N=document.body.dataset.viewMode)!=null?N:"global",w=document.getElementById("root"),r,b={creating:!1,editingId:void 0},v=new Map,y=new Set;R();f();window.addEventListener("message",e=>{let t=e.data;switch(t.type){case"stateUpdate":D(t.payload);break;case"startInlineCreate":F(t.scope);break;case"startInlineEdit":P(t.scope,t.todoId);break;default:break}});I.postMessage({type:"webviewReady",mode:C});function D(e){r=e,B(),f()}function F(e){if(!h(e))return;let t=p(e);t.creating=!0,t.editingId=void 0,L(`[data-inline-create="${T(e)}"]`),u(),f()}function P(e,t){if(!h(e))return;let n=p(e);n.creating=!1,n.editingId=t,L(`[data-inline-edit="${t}"]`),u(),f()}function h(e){return C==="global"?e.scope==="global":e.scope==="workspace"}function R(){var t,n;let e=I.getState();e&&(Object.assign(b,(t=e.global)!=null?t:{creating:!1}),Object.entries((n=e.workspaces)!=null?n:{}).forEach(([o,a])=>{v.set(o,{creating:a.creating,editingId:a.editingId})}))}function u(){let e={global:{...b},workspaces:{}};v.forEach((t,n)=>{e.workspaces[n]={...t}}),I.setState(e)}function p(e){if(e.scope==="global")return b;let t=v.get(e.workspaceFolder);return t||(t={creating:!1},v.set(e.workspaceFolder,t)),t}function B(){if(!r)return;if(C==="global"){b.editingId&&!r.global.todos.some(t=>t.id===b.editingId)&&(b.editingId=void 0);return}let e=new Set(r.projects.folders.map(t=>t.key));Array.from(v.keys()).forEach(t=>{e.has(t)||v.delete(t)}),v.forEach((t,n)=>{let o=r==null?void 0:r.projects.folders.find(a=>a.key===n);o&&t.editingId&&!o.todos.some(a=>a.id===t.editingId)&&(t.editingId=void 0)})}function f(){if(!r){w.innerHTML='<p class="empty-state">Waiting for TODOs\u2026</p>';return}w.innerHTML="",C==="global"?w.appendChild(q(r.global,{scope:"global"})):w.appendChild(O(r.projects)),z()}function q(e,t){let n=document.createElement("section");n.className="todo-section";let o=document.createElement("div");o.className="todo-list";let a=p(t);if(a.creating&&o.appendChild(x(t)),e.todos.forEach(i=>{o.appendChild(A(t,i,a))}),e.todos.length===0&&!a.creating){let i=document.createElement("p");i.className="empty-state",i.textContent=e.emptyLabel,o.appendChild(i)}return j(o,t),n.appendChild(o),n}function O(e){let t=document.createElement("section");if(t.className="todo-section",e.folders.length===0){let n=document.createElement("p");return n.className="empty-state",n.textContent=e.emptyLabel,t.appendChild(n),t}return e.folders.forEach(n=>{var M;let o={scope:"workspace",workspaceFolder:n.key},a=p(o),i=document.createElement("div");i.className="workspace-section";let d=document.createElement("div");d.className="workspace-title",d.textContent=n.label;let c=document.createElement("div");c.className="section-actions";let m=document.createElement("button");m.className="button-link",m.textContent="+ Add",m.addEventListener("click",()=>$(o)),c.appendChild(m);let g=document.createElement("button");g.className="button-link",g.textContent="Clear",g.addEventListener("click",()=>S({type:"clearScope",scope:o})),c.appendChild(g);let s=document.createElement("div");s.style.display="flex",s.style.justifyContent="space-between",s.style.alignItems="center",s.appendChild(d),s.appendChild(c),i.appendChild(s);let l=document.createElement("div");if(l.className="todo-list",a.creating&&l.appendChild(x(o)),n.todos.forEach(E=>{l.appendChild(A(o,E,a))}),n.todos.length===0&&!a.creating){let E=document.createElement("p");E.className="empty-state",E.textContent=(M=r==null?void 0:r.projects.emptyLabel)!=null?M:"",l.appendChild(E)}j(l,o),i.appendChild(l),t.appendChild(i)}),t}function x(e){var a,i;let t=document.createElement("div");t.className="todo-item inline-create";let n=document.createElement("input");n.className="todo-input",n.placeholder=(a=r==null?void 0:r.strings.addPlaceholder)!=null?a:"Type a TODO",n.dataset.inlineCreate=T(e),n.addEventListener("keydown",d=>{d.key==="Enter"&&(d.preventDefault(),V(e,n.value)),d.key==="Escape"&&(d.preventDefault(),W(e))}),n.addEventListener("blur",()=>{n.value.trim().length===0&&W(e)}),t.appendChild(n);let o=document.createElement("small");return o.className="inline-hint",o.textContent=(i=r==null?void 0:r.strings.inlineCreateHint)!=null?i:"",t.appendChild(o),t}function A(e,t,n){var m,g;let o=document.createElement("div");if(o.className="todo-item",o.dataset.todoId=t.id,o.draggable=!0,n.editingId===t.id){let s=document.createElement("input");s.className="todo-input",s.value=t.title,s.dataset.inlineEdit=t.id,s.addEventListener("keydown",l=>{l.key==="Enter"&&(l.preventDefault(),U(e,t.id,s.value)),l.key==="Escape"&&(l.preventDefault(),k(e))}),s.addEventListener("blur",()=>{s.value.trim().length===0&&k(e)}),o.appendChild(s)}else{let s=document.createElement("span");s.className=`todo-title${t.completed?" completed":""}`,s.textContent=t.title,s.addEventListener("dblclick",()=>H(e,t.id)),o.appendChild(s)}let a=document.createElement("div");a.className="todo-actions";let i=document.createElement("button");i.className="todo-action",i.title=(m=r==null?void 0:r.strings.completeLabel)!=null?m:"Toggle complete",i.textContent=t.completed?"\u21BA":"\u2713",i.addEventListener("click",()=>S({type:"toggleComplete",scope:e,todoId:t.id})),a.appendChild(i);let d=document.createElement("button");d.className="todo-action",d.textContent="\u270E",d.title="Edit",d.addEventListener("click",()=>H(e,t.id)),a.appendChild(d);let c=document.createElement("button");return c.className="todo-action",c.textContent="\u2715",c.title=(g=r==null?void 0:r.strings.removeLabel)!=null?g:"Remove",c.addEventListener("click",()=>S({type:"removeTodo",scope:e,todoId:t.id})),a.appendChild(c),o.appendChild(a),o}function $(e){if(!h(e))return;let t=p(e);t.creating=!0,t.editingId=void 0,L(`[data-inline-create="${T(e)}"]`),u(),f()}function W(e){let t=p(e);t.creating=!1,u(),f()}function V(e,t){let n=t.trim();if(n.length===0){W(e);return}S({type:"commitCreate",scope:e,title:n});let o=p(e);o.creating=!1,u()}function H(e,t){if(!h(e))return;let n=p(e);n.creating=!1,n.editingId=t,L(`[data-inline-edit="${t}"]`),u(),f()}function k(e){let t=p(e);t.editingId=void 0,u(),f()}function U(e,t,n){let o=n.trim();if(o.length===0){k(e);return}S({type:"commitEdit",scope:e,todoId:t,title:o});let a=p(e);a.editingId=void 0,u()}function j(e,t){let n;e.addEventListener("dragstart",a=>{var d,c;let i=(d=a.target)==null?void 0:d.closest(".todo-item");!i||!i.dataset.todoId||(n=i.dataset.todoId,(c=a.dataTransfer)==null||c.setData("text/plain",n))}),e.addEventListener("dragover",a=>{var d;if(!n)return;let i=(d=a.target)==null?void 0:d.closest(".todo-item");!i||!i.dataset.todoId||i.dataset.todoId===n||(a.preventDefault(),i.classList.add("drag-over"))}),e.addEventListener("dragleave",a=>{var d;let i=(d=a.target)==null?void 0:d.closest(".todo-item");i==null||i.classList.remove("drag-over")}),e.addEventListener("drop",a=>{var s;a.preventDefault();let i=(s=a.target)==null?void 0:s.closest(".todo-item");if(!i||!i.dataset.todoId||!n||i.dataset.todoId===n){o(e);return}let d=e.querySelector(`.todo-item[data-todo-id="${n}"]`);if(!d){o(e);return}let c=i.getBoundingClientRect(),m=a.clientY<c.top+c.height/2;e.insertBefore(d,m?i:i.nextElementSibling);let g=Array.from(e.querySelectorAll(".todo-item")).map(l=>l.dataset.todoId).filter(l=>!!l);S({type:"reorderTodos",scope:t,order:g}),o(e)}),e.addEventListener("dragend",()=>{o(e)});function o(a){n=void 0,a.querySelectorAll(".drag-over").forEach(i=>i.classList.remove("drag-over"))}}function L(e){y.add(e)}function z(){if(y.size===0)return;let e=Array.from(y.values());y.clear(),requestAnimationFrame(()=>{e.forEach(t=>{let n=document.querySelector(t);n&&(n.focus(),n.setSelectionRange(n.value.length,n.value.length))})})}function T(e){return e.scope==="global"?"global":e.workspaceFolder}function S(e){I.postMessage(e)}})();
